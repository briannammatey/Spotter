<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Workout - Spotter</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
<header class="site-header">
    <div id="background">
        <nav id="navbar">
            <div class="brand">
                <img id="bu_pic" src="/img/bu_dog.png">
                <p id="title">üêæSPOTTER üêæ</p>
            </div>
            <ul>
                <li><a href="homepage.html">Homepage</a></li>
                <li><a href="index.html">Challenge</a></li>
                <li><a href="workoutsection.html">Workout</a></li>
                <li><a href="recipe.html">Recipes</a></li>
                <li><a href="addFriends.html">AddFriends</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="#" onclick="logout(); return false;">üö™ Logout</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="webbody">
    <h2 id="challenge">LOG YOUR WORKOUT</h2>
    <div class="box">
        <!-- Error/Success Messages -->
        <div id="messageContainer" style="display: none;"></div>
        
        <h4 class="questions">Workout Name</h4>
        <textarea id="workoutName" type="text" placeholder="e.g., Morning Run, Leg Day, Yoga Session" class="textBox"></textarea>

        <h4 class="questions">Date</h4>
        <label for="workout-date"></label>
        <input type="date" id="workout-date" class="date-box">

        <h4 class="questions">Duration (minutes)</h4>
        <textarea id="workoutDuration" type="number" placeholder="Enter duration in minutes" class="textBox"></textarea>

        <h4 class="questions">Workout Type</h4>
        <div class="button-toggle">
            <input type="radio" id="cardio" name="workout-type" value="cardio">
            <label for="cardio">Cardio</label>

            <input type="radio" id="strength" name="workout-type" value="strength">
            <label for="strength">Strength</label>
        </div>

        <div class="button-toggle" style="margin-top: 10px;">
            <input type="radio" id="flexibility" name="workout-type" value="flexibility">
            <label for="flexibility">Flexibility</label>

            <input type="radio" id="sports" name="workout-type" value="sports">
            <label for="sports">Sports</label>
        </div>

        <h4 class="questions">Intensity Level</h4>
        <div class="button-toggle">
            <input type="radio" id="low" name="intensity" value="low">
            <label for="low">Low</label>

            <input type="radio" id="medium" name="intensity" value="medium">
            <label for="medium">Medium</label>

            <input type="radio" id="high" name="intensity" value="high">
            <label for="high">High</label>
        </div>

        <h4 class="questions">Calories Burned (optional)</h4>
        <textarea id="workoutCalories" type="number" placeholder="Estimated calories burned" class="textBox"></textarea>

        <h4 class="questions">Workout Notes</h4>
        <textarea id="workoutNotes" class="big-box" placeholder="Add any notes about your workout - exercises performed, how you felt, personal records, etc."></textarea>

        <h4 class="questions">Select privacy:</h4>
        <div class="button-toggle">
            <input type="radio" id="privateOption" name="privacy" value="private">
            <label for="privateOption">Private</label>

            <input type="radio" id="publicOption" name="privacy" value="public">
            <label for="publicOption">Public</label>
        </div>

        <div class="button-toggle-2">
            <button type="button" id="logWorkoutBtn" class="submit-challenge-btn">LOG WORKOUT</button>
        </div>
    </div>
</div>

<!-- Include auth utilities -->
<script src="auth-utils.js"></script>

<script>
// Check authentication on page load
requireAuth();

// Form submission handler
document.getElementById('logWorkoutBtn').addEventListener('click', async function() {
    // Get form values
    const workoutName = document.getElementById('workoutName').value.trim();
    const workoutDate = document.getElementById('workout-date').value;
    const duration = document.getElementById('workoutDuration').value.trim();
    const workoutType = document.querySelector('input[name="workout-type"]:checked')?.value;
    const intensity = document.querySelector('input[name="intensity"]:checked')?.value;
    const calories = document.getElementById('workoutCalories').value.trim();
    const notes = document.getElementById('workoutNotes').value.trim();
    const privacy = document.querySelector('input[name="privacy"]:checked')?.value;
    
    // Client-side validation
    const errors = [];
    
    if (!workoutName) errors.push("Workout name is required");
    if (!workoutDate) errors.push("Workout date is required");
    if (!duration) errors.push("Duration is required");
    if (!workoutType) errors.push("Workout type is required");
    if (!intensity) errors.push("Intensity level is required");
    if (!notes) errors.push("Workout notes are required");
    if (!privacy) errors.push("Privacy setting is required");
    
    if (errors.length > 0) {
        showMessage(errors.join('<br>'), 'error');
        return;
    }
    
    // Prepare data
    const workoutData = {
        workout_name: workoutName,
        date: workoutDate,
        duration: duration,
        workout_type: workoutType,
        intensity: intensity,
        notes: notes,
        privacy: privacy
    };
    
    // Only add calories if it's provided
    if (calories && calories.trim() !== '') {
        workoutData.calories = calories;
    }
    
    // Disable button while submitting
    const btn = document.getElementById('logWorkoutBtn');
    const originalText = btn.textContent;
    btn.textContent = 'LOGGING...';
    btn.disabled = true;
    
    try {
        // Send to backend with authentication
        const response = await authFetch('/api/log_workout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(workoutData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showMessage('Workout logged successfully! Redirecting...', 'success');
            // Redirect to homepage after 1.5 seconds
            setTimeout(() => {
                window.location.href = 'homepage.html';
            }, 1500);
        } else {
            showMessage(result.errors.join('<br>'), 'error');
            btn.textContent = originalText;
            btn.disabled = false;
        }
    } catch (error) {
        showMessage('Error connecting to server. Please make sure the backend is running.', 'error');
        btn.textContent = originalText;
        btn.disabled = false;
    }
});

// Show message function
function showMessage(message, type) {
    const messageContainer = document.getElementById('messageContainer');
    messageContainer.innerHTML = message;
    messageContainer.className = type === 'success' ? 'success-message' : 'error-message';
    messageContainer.style.display = 'block';
    
    // Auto-hide after 5 seconds for errors
    if (type === 'error') {
        setTimeout(() => {
            messageContainer.style.display = 'none';
        }, 5000);
    }
}
</script>

</body>
</html>