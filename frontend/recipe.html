<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Generator - Spotter</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
</head>

<body>
<header class="site-header">
    <div id="background">
        <nav id="navbar">
            <div class="brand">
                <img id="bu_pic" src="/img/bu_dog.png">
                <p id="title">ğŸ¾SPOTTER ğŸ¾</p>
            </div>
            <ul>
                <li><a href="homepage.html">Homepage</a></li>
                <li><a href="index.html">Challenge</a></li>
                <li><a href="workoutsection.html">Workout</a></li>
                <li><a href="recipe.html">Recipes</a></li>
                <li><a href="addFriends.html">AddFriends</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="webbody">
    <h2 id="challenge">ğŸ½ï¸ RECIPE GENERATOR</h2>
    <div class="box recipe-box">
        
        <h4 class="questions">What's Your Goal?</h4>
        <div class="button-toggle">
            <input type="radio" id="bulking" name="goal" value="bulking">
            <label for="bulking">ğŸ‹ï¸ Bulking</label>

            <input type="radio" id="cutting" name="goal" value="cutting">
            <label for="cutting">ğŸ”¥ Cutting</label>

            <input type="radio" id="maintenance" name="goal" value="maintenance">
            <label for="maintenance">âš–ï¸ Maintenance</label>
        </div>

        <h4 class="questions">Dietary Preference</h4>
        <div class="button-toggle">
            <input type="radio" id="none" name="diet" value="none">
            <label for="none">No Preference</label>

            <input type="radio" id="vegetarian" name="diet" value="vegetarian">
            <label for="vegetarian">ğŸ¥— Vegetarian</label>

            <input type="radio" id="vegan" name="diet" value="vegan">
            <label for="vegan">ğŸŒ± Vegan</label>
        </div>

        <div class="button-toggle" style="margin-top: 10px;">
            <input type="radio" id="keto" name="diet" value="keto">
            <label for="keto">ğŸ¥‘ Keto</label>

            <input type="radio" id="highprotein" name="diet" value="highprotein">
            <label for="highprotein">ğŸ’ª High Protein</label>

            <input type="radio" id="glutenfree" name="diet" value="glutenfree">
            <label for="glutenfree">ğŸŒ¾ Gluten-Free</label>
        </div>

        <h4 class="questions">Meal Type</h4>
        <div class="button-toggle">
            <input type="radio" id="breakfast" name="meal" value="breakfast">
            <label for="breakfast">ğŸŒ… Breakfast</label>

            <input type="radio" id="lunch" name="meal" value="lunch">
            <label for="lunch">â˜€ï¸ Lunch</label>

            <input type="radio" id="dinner" name="meal" value="dinner">
            <label for="dinner">ğŸŒ™ Dinner</label>

            <input type="radio" id="snack" name="meal" value="snack">
            <label for="snack">ğŸ Snack</label>
        </div>

        <h4 class="questions">Calorie Target (per meal)</h4>
        <div class="button-toggle">
            <input type="radio" id="cal300" name="calories" value="300">
            <label for="cal300">~300 cal</label>

            <input type="radio" id="cal500" name="calories" value="500">
            <label for="cal500">~500 cal</label>

            <input type="radio" id="cal700" name="calories" value="700">
            <label for="cal700">~700 cal</label>

            <input type="radio" id="cal900" name="calories" value="900">
            <label for="cal900">~900 cal</label>
        </div>

        <h4 class="questions">Cooking Time</h4>
        <div class="button-toggle">
            <input type="radio" id="quick" name="time" value="quick">
            <label for="quick">âš¡ Under 15 min</label>

            <input type="radio" id="medium" name="time" value="medium">
            <label for="medium">â±ï¸ 15-30 min</label>

            <input type="radio" id="long" name="time" value="long">
            <label for="long">ğŸ³ 30+ min</label>
        </div>

        <h4 class="questions">Ingredients You Have (optional)</h4>
        <textarea id="ingredients" class="big-box" placeholder="List any ingredients you'd like to use, separated by commas (e.g., chicken, rice, broccoli, eggs...)"></textarea>


        <h4 class="questions">Allergies or Ingredients to Avoid</h4>
        <textarea id="allergies" class="textBox" placeholder="e.g., nuts, shellfish, dairy..."></textarea>


         <div class="button-toggle-2">
            <button type="button" id="generateRecipeBtn" class="submit-challenge-btn">ğŸ´ GENERATE RECIPE</button>
        </div>


        <!-- Recipe Output Section -->
        <div class="recipe-output" id="recipeOutput">
            <h3 class="recipe-title">Your Recipe Will Appear Here</h3>
            <p class="recipe-placeholder">Select your preferences above and click "Generate Recipe" to get a personalized meal suggestion!</p>
        </div>
    </div>
</div>




















<script>
document.getElementById("generateRecipeBtn").addEventListener("click", async function () {
    const getCheckedValue = (name) => {
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : null;
    };

    const body = {
        goal: getCheckedValue("goal"),
        diet: getCheckedValue("diet"),
        mealType: getCheckedValue("meal"),
        calorieTarget: getCheckedValue("calories"),
        cookingTime: getCheckedValue("time"),
        ingredients: document.getElementById("ingredients").value,
        allergies: document.getElementById("allergies").value,
    };

    const output = document.getElementById("recipeOutput");
    output.innerHTML = `
        <div class="loading-recipe">
            <div class="loading-spinner">ğŸ³</div>
            <p class="loading-text">Generating your personalized recipe...</p>
        </div>
    `;

    try {
        const token = localStorage.getItem("spotterToken");
        const res = await fetch("http://localhost:5001/api/recipe-plan", {
            method: "POST",
            headers: { 
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify(body),
        });

        console.log("Response status:", res.status);

        if (!res.ok) {
            throw new Error("Network response was not ok");
        }

        // Safely parse JSON
        const data = await res.json();
        console.log("Recipe data:", data);

        if (!data.meals || data.meals.length === 0) {
            output.innerHTML = `
                <div class="no-recipes">
                    <div class="no-recipes-icon">ğŸ˜”</div>
                    <h3 class="no-recipes-title">No Recipes Found</h3>
                    <p class="no-recipes-text">
                        Try adjusting your preferences or removing some filters to find more options!
                    </p>
                </div>
            `;
            return;
        }

        const mealHtml = data.meals.map(meal => `
            <div class="meal-card">
                <div class="meal-header">
                    <h3 class="meal-name">${meal.meal_type} â€“ ${meal.name}</h3>
                    <span class="meal-calories">ğŸ”¥ ${meal.calories} cal</span>
                </div>
                <div class="meal-section">
                    <h4 class="meal-section-title">ğŸ›’ Ingredients:</h4>
                    <p class="meal-ingredients">${Array.isArray(meal.ingredients) ? meal.ingredients.join(", ") : meal.ingredients}</p>
                </div>
                <div class="meal-section">
                    <h4 class="meal-section-title">ğŸ‘¨â€ğŸ³ Instructions:</h4>
                    <p class="meal-instructions">${meal.instructions}</p>
                </div>
            </div>
        `).join("");

        output.innerHTML = `
            <h3 class="recipe-result-title">
                âœ¨ Your Recipe ${data.meals.length > 1 ? "Plan" : ""}
            </h3>
            <div class="total-calories">Total: ${data.total_calories} calories</div>
            ${mealHtml}
        `;
    } catch (err) {
        console.error("Recipe error:", err);
        output.innerHTML = `
            <div class="recipe-error">
                <div class="error-icon">âš ï¸</div>
                <h3 class="error-title">Oops! Something Went Wrong</h3>
                <p class="error-text">
                    Unable to generate your recipe plan. Please make sure the backend is running and try again.
                </p>
            </div>
        `;
    }
});
</script>

<script>
const token = localStorage.getItem("spotterToken");
if (!token) {
    // Not logged in â†’ go to login
    window.location.href = "login.html";
}
</script>

</body>
</html>